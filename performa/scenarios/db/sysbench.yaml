title: Sysbench DB

description:
  This scenario uses sysbench to execute DB test plan.

setup:
  -
    hosts: $target
    tasks:
    - name: installing sysbench
      apt: name=sysbench
      become: yes
      become_user: root
      become_method: sudo
    - name: installing atop
      apt:
        name: atop, daemon
      become: yes
      become_user: root
      become_method: sudo
  -
    hosts: $target
    tasks:
    - atop: command=start

execution:
  -
    hosts: $target
    matrix:
      threads: [ 10, 20, 30 ]
    tasks:
    - sysbench_oltp:
        duration: 10
  -
    hosts: $target
    tasks:
    - atop:
        command: stop
        labels: [ CPU, PRC, PRM ]

report:
  template: sysbench.rst
